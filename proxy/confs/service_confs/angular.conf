gzip_static on;    
gzip_types text/plain text/css text/xml text/json application/javascript;
gzip_vary on;
gzip_proxied any;
gzip_http_version 1.0;

# This will serve all js and css dist files, to be cached for very long
location / {
    include /etc/nginx/sites-enabled/security-headers;

    # 1 month
    add_header Cache-Control "max-age=2592000" always;
}

# Do not cache the index otherwise 404 errors will be raised
# after new builds due to chunks hashed with different names
location = /index.html {

    include /etc/nginx/sites-enabled/security-headers;

    add_header Cache-Control "no-store" always;
}

# Create an "alias" from app, app/*, public and public/* to index.html
location = /app {
    rewrite . /index.html last;
}
location = /public {
    rewrite . /index.html last;
}
location /app/ {
    rewrite . /index.html last;
}
location /public/ {
    rewrite . /index.html last;
}

# Assets, to be cached
location /app/rapydo {
    root /app/dist;

    include /etc/nginx/sites-enabled/security-headers;
    # 1 month
    add_header Cache-Control "max-age=2592000" always;
    
}
location /app/custom {
    root /app/dist;

    include /etc/nginx/sites-enabled/security-headers;
    # 1 month
    add_header Cache-Control "max-age=2592000" always;
}

location /resources/ {
    root /;

    include /etc/nginx/sites-enabled/security-headers;
    # 1 month
    add_header Cache-Control "max-age=2592000" always;
}


